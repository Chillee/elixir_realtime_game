{"version":3,"sources":["node_modules/phoenix/priv/static/phoenix.js","web/static/js/app.js","web/static/js/camera.js","web/static/js/constants.js","web/static/js/entities.js","web/static/js/game.js","web/static/js/state.js"],"names":["Object","defineProperty","exports","value","phoenix_1","require","constants_1","state_1","entities_1","game_1","App","socket","Socket","connect","roomChan","channel","join","receive","console","log","onError","e","on","data","run","id","team","blocks","block","game","state","level","collidables","push","PlayerBlock","x","y","Game","c","canvas","sheet","spriteSheet","gs","msg","user_id","changedPlayer","playerStates","filter","length","PlayerState","res","new_id","player_idx","findIndex","splice","Math","floor","random","userState","block_ids","indexOf","i","Constants","TEAMS","flags","holding_id","flag_holder","scores","score","start","default","Camera","user","targetX","PLAYER_W","W","targetY","PLAYER_H","H","cx","cy","LEVEL_W","LEVEL_H","TEAM_NAMES","DESTROY_RADIUS","camera_1","Block","w","h","left","right","top","bottom","ctx","fillRect","drawImage","Flag","ScoringArea","Spike","Explosion","startTick","dead","tick","frame","Level","flag","Array","explosions","levelImage","Image","src","onload","document","createElement","width","height","getContext","getImageData","r","g","b","addBlock","user_team","spawnX","spawnY","addSpike","addScoringArea","addFlag","PlayerData","nickname","getElementById","GameState","a","flag_team","blockX","blockY","pX","pY","hypot","ids","obj","blockInRange","user_nickname","teleportPlayer","deathAnimFrame","dx","dy","collisions","players","can_jump","checkCollision","scoreFlag","Key","isDown","UP","takeFlag","killPlayer","draw","fillStyle","x_dir","translate","scale","setTransform","nonUserStates","player","exp","scoreText","font","textBaseline","textPadding","team0Score","fillText","team1Score","measureText","_pressed","SPACE","LEFT","RIGHT","DOWN","keyCode","onKeydown","event","sudoku","onKeyup","window","addEventListener","check_bounds","update","jump_v","v","abs","updateTarget","setInterval","fps","fill","create"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3vCA;;;;;;AACAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEC,OAAO,IAAT,EAA7C;AACA,IAAMC,YAAYC,QAAQ,SAAR,CAAlB;AACA,IAAMC,cAAcD,QAAQ,aAAR,CAApB;AACA,IAAME,UAAUF,QAAQ,SAAR,CAAhB;AACA,IAAMG,aAAaH,QAAQ,YAAR,CAAnB;AACA,IAAMI,SAASJ,QAAQ,QAAR,CAAf;;IACMK,G;;;;;;;gCACa;AAAA;;AACX,iBAAKC,MAAL,GAAc,IAAIP,UAAUQ,MAAd,CAAqB,SAArB,EAAgC,EAAhC,CAAd;AACA,iBAAKD,MAAL,CAAYE,OAAZ;AACA,iBAAKC,QAAL,GAAgB,KAAKH,MAAL,CAAYI,OAAZ,CAAoB,aAApB,EAAmC,EAAnC,CAAhB;AACA,iBAAKD,QAAL,CAAcE,IAAd,GAAqBC,OAArB,CAA6B,QAA7B,EAAuC;AAAA,uBAAMC,QAAQC,GAAR,CAAY,YAAZ,CAAN;AAAA,aAAvC,EACKF,OADL,CACa,IADb,EACmB,YAAM;AAAEC,wBAAQC,GAAR,CAAY,SAAZ;AAAyB,aADpD;AAEA,iBAAKL,QAAL,CAAcM,OAAd,CAAsB;AAAA,uBAAKF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","file":"priv/static/js/app.js","sourcesContent":["\nrequire.register(\"phoenix/priv/static/phoenix.js\", function(exports, require, module) {\n  require = __makeRelativeRequire(require, {}, \"phoenix\");\n  (function() {\n    (function(exports){\n\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n// Phoenix Channels JavaScript client\n//\n// ## Socket Connection\n//\n// A single connection is established to the server and\n// channels are multiplexed over the connection.\n// Connect to the server using the `Socket` class:\n//\n//     let socket = new Socket(\"/ws\", {params: {userToken: \"123\"}})\n//     socket.connect()\n//\n// The `Socket` constructor takes the mount point of the socket,\n// the authentication params, as well as options that can be found in\n// the Socket docs, such as configuring the `LongPoll` transport, and\n// heartbeat.\n//\n// ## Channels\n//\n// Channels are isolated, concurrent processes on the server that\n// subscribe to topics and broker events between the client and server.\n// To join a channel, you must provide the topic, and channel params for\n// authorization. Here's an example chat room example where `\"new_msg\"`\n// events are listened for, messages are pushed to the server, and\n// the channel is joined with ok/error/timeout matches:\n//\n//     let channel = socket.channel(\"room:123\", {token: roomToken})\n//     channel.on(\"new_msg\", msg => console.log(\"Got message\", msg) )\n//     $input.onEnter( e => {\n//       channel.push(\"new_msg\", {body: e.target.val}, 10000)\n//        .receive(\"ok\", (msg) => console.log(\"created message\", msg) )\n//        .receive(\"error\", (reasons) => console.log(\"create failed\", reasons) )\n//        .receive(\"timeout\", () => console.log(\"Networking issue...\") )\n//     })\n//     channel.join()\n//       .receive(\"ok\", ({messages}) => console.log(\"catching up\", messages) )\n//       .receive(\"error\", ({reason}) => console.log(\"failed join\", reason) )\n//       .receive(\"timeout\", () => console.log(\"Networking issue. Still waiting...\") )\n//\n//\n// ## Joining\n//\n// Creating a channel with `socket.channel(topic, params)`, binds the params to\n// `channel.params`, which are sent up on `channel.join()`.\n// Subsequent rejoins will send up the modified params for\n// updating authorization params, or passing up last_message_id information.\n// Successful joins receive an \"ok\" status, while unsuccessful joins\n// receive \"error\".\n//\n// ## Duplicate Join Subscriptions\n//\n// While the client may join any number of topics on any number of channels,\n// the client may only hold a single subscription for each unique topic at any\n// given time. When attempting to create a duplicate subscription,\n// the server will close the existing channel, log a warning, and\n// spawn a new channel for the topic. The client will have their\n// `channel.onClose` callbacks fired for the existing channel, and the new\n// channel join will have its receive hooks processed as normal.\n//\n// ## Pushing Messages\n//\n// From the previous example, we can see that pushing messages to the server\n// can be done with `channel.push(eventName, payload)` and we can optionally\n// receive responses from the push. Additionally, we can use\n// `receive(\"timeout\", callback)` to abort waiting for our other `receive` hooks\n//  and take action after some period of waiting. The default timeout is 5000ms.\n//\n//\n// ## Socket Hooks\n//\n// Lifecycle events of the multiplexed connection can be hooked into via\n// `socket.onError()` and `socket.onClose()` events, ie:\n//\n//     socket.onError( () => console.log(\"there was an error with the connection!\") )\n//     socket.onClose( () => console.log(\"the connection dropped\") )\n//\n//\n// ## Channel Hooks\n//\n// For each joined channel, you can bind to `onError` and `onClose` events\n// to monitor the channel lifecycle, ie:\n//\n//     channel.onError( () => console.log(\"there was an error!\") )\n//     channel.onClose( () => console.log(\"the channel has gone away gracefully\") )\n//\n// ### onError hooks\n//\n// `onError` hooks are invoked if the socket connection drops, or the channel\n// crashes on the server. In either case, a channel rejoin is attempted\n// automatically in an exponential backoff manner.\n//\n// ### onClose hooks\n//\n// `onClose` hooks are invoked only in two cases. 1) the channel explicitly\n// closed on the server, or 2). The client explicitly closed, by calling\n// `channel.leave()`\n//\n//\n// ## Presence\n//\n// The `Presence` object provides features for syncing presence information\n// from the server with the client and handling presences joining and leaving.\n//\n// ### Syncing initial state from the server\n//\n// `Presence.syncState` is used to sync the list of presences on the server\n// with the client's state. An optional `onJoin` and `onLeave` callback can\n// be provided to react to changes in the client's local presences across\n// disconnects and reconnects with the server.\n//\n// `Presence.syncDiff` is used to sync a diff of presence join and leave\n// events from the server, as they happen. Like `syncState`, `syncDiff`\n// accepts optional `onJoin` and `onLeave` callbacks to react to a user\n// joining or leaving from a device.\n//\n// ### Listing Presences\n//\n// `Presence.list` is used to return a list of presence information\n// based on the local state of metadata. By default, all presence\n// metadata is returned, but a `listBy` function can be supplied to\n// allow the client to select which metadata to use for a given presence.\n// For example, you may have a user online from different devices with a\n// a metadata status of \"online\", but they have set themselves to \"away\"\n// on another device. In this case, they app may choose to use the \"away\"\n// status for what appears on the UI. The example below defines a `listBy`\n// function which prioritizes the first metadata which was registered for\n// each user. This could be the first tab they opened, or the first device\n// they came online from:\n//\n//     let state = {}\n//     state = Presence.syncState(state, stateFromServer)\n//     let listBy = (id, {metas: [first, ...rest]}) => {\n//       first.count = rest.length + 1 // count of this user's presences\n//       first.id = id\n//       return first\n//     }\n//     let onlineUsers = Presence.list(state, listBy)\n//\n//\n// ### Example Usage\n//\n//     // detect if user has joined for the 1st time or from another tab/device\n//     let onJoin = (id, current, newPres) => {\n//       if(!current){\n//         console.log(\"user has entered for the first time\", newPres)\n//       } else {\n//         console.log(\"user additional presence\", newPres)\n//       }\n//     }\n//     // detect if user has left from all tabs/devices, or is still present\n//     let onLeave = (id, current, leftPres) => {\n//       if(current.metas.length === 0){\n//         console.log(\"user has left from all devices\", leftPres)\n//       } else {\n//         console.log(\"user left from a device\", leftPres)\n//       }\n//     }\n//     let presences = {} // client's initial empty presence state\n//     // receive initial presence data from server, sent after join\n//     myChannel.on(\"presences\", state => {\n//       presences = Presence.syncState(presences, state, onJoin, onLeave)\n//       displayUsers(Presence.list(presences))\n//     })\n//     // receive \"presence_diff\" from server, containing join/leave events\n//     myChannel.on(\"presence_diff\", diff => {\n//       presences = Presence.syncDiff(presences, diff, onJoin, onLeave)\n//       this.setState({users: Presence.list(room.presences, listBy)})\n//     })\n//\nvar VSN = \"1.0.0\";\nvar SOCKET_STATES = { connecting: 0, open: 1, closing: 2, closed: 3 };\nvar DEFAULT_TIMEOUT = 10000;\nvar CHANNEL_STATES = {\n  closed: \"closed\",\n  errored: \"errored\",\n  joined: \"joined\",\n  joining: \"joining\",\n  leaving: \"leaving\"\n};\nvar CHANNEL_EVENTS = {\n  close: \"phx_close\",\n  error: \"phx_error\",\n  join: \"phx_join\",\n  reply: \"phx_reply\",\n  leave: \"phx_leave\"\n};\nvar TRANSPORTS = {\n  longpoll: \"longpoll\",\n  websocket: \"websocket\"\n};\n\nvar Push = function () {\n\n  // Initializes the Push\n  //\n  // channel - The Channel\n  // event - The event, for example `\"phx_join\"`\n  // payload - The payload, for example `{user_id: 123}`\n  // timeout - The push timeout in milliseconds\n  //\n\n  function Push(channel, event, payload, timeout) {\n    _classCallCheck(this, Push);\n\n    this.channel = channel;\n    this.event = event;\n    this.payload = payload || {};\n    this.receivedResp = null;\n    this.timeout = timeout;\n    this.timeoutTimer = null;\n    this.recHooks = [];\n    this.sent = false;\n  }\n\n  _createClass(Push, [{\n    key: \"resend\",\n    value: function resend(timeout) {\n      this.timeout = timeout;\n      this.cancelRefEvent();\n      this.ref = null;\n      this.refEvent = null;\n      this.receivedResp = null;\n      this.sent = false;\n      this.send();\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      if (this.hasReceived(\"timeout\")) {\n        return;\n      }\n      this.startTimeout();\n      this.sent = true;\n      this.channel.socket.push({\n        topic: this.channel.topic,\n        event: this.event,\n        payload: this.payload,\n        ref: this.ref\n      });\n    }\n  }, {\n    key: \"receive\",\n    value: function receive(status, callback) {\n      if (this.hasReceived(status)) {\n        callback(this.receivedResp.response);\n      }\n\n      this.recHooks.push({ status: status, callback: callback });\n      return this;\n    }\n\n    // private\n\n  }, {\n    key: \"matchReceive\",\n    value: function matchReceive(_ref) {\n      var status = _ref.status;\n      var response = _ref.response;\n      var ref = _ref.ref;\n\n      this.recHooks.filter(function (h) {\n        return h.status === status;\n      }).forEach(function (h) {\n        return h.callback(response);\n      });\n    }\n  }, {\n    key: \"cancelRefEvent\",\n    value: function cancelRefEvent() {\n      if (!this.refEvent) {\n        return;\n      }\n      this.channel.off(this.refEvent);\n    }\n  }, {\n    key: \"cancelTimeout\",\n    value: function cancelTimeout() {\n      clearTimeout(this.timeoutTimer);\n      this.timeoutTimer = null;\n    }\n  }, {\n    key: \"startTimeout\",\n    value: function startTimeout() {\n      var _this = this;\n\n      if (this.timeoutTimer) {\n        return;\n      }\n      this.ref = this.channel.socket.makeRef();\n      this.refEvent = this.channel.replyEventName(this.ref);\n\n      this.channel.on(this.refEvent, function (payload) {\n        _this.cancelRefEvent();\n        _this.cancelTimeout();\n        _this.receivedResp = payload;\n        _this.matchReceive(payload);\n      });\n\n      this.timeoutTimer = setTimeout(function () {\n        _this.trigger(\"timeout\", {});\n      }, this.timeout);\n    }\n  }, {\n    key: \"hasReceived\",\n    value: function hasReceived(status) {\n      return this.receivedResp && this.receivedResp.status === status;\n    }\n  }, {\n    key: \"trigger\",\n    value: function trigger(status, response) {\n      this.channel.trigger(this.refEvent, { status: status, response: response });\n    }\n  }]);\n\n  return Push;\n}();\n\nvar Channel = exports.Channel = function () {\n  function Channel(topic, params, socket) {\n    var _this2 = this;\n\n    _classCallCheck(this, Channel);\n\n    this.state = CHANNEL_STATES.closed;\n    this.topic = topic;\n    this.params = params || {};\n    this.socket = socket;\n    this.bindings = [];\n    this.timeout = this.socket.timeout;\n    this.joinedOnce = false;\n    this.joinPush = new Push(this, CHANNEL_EVENTS.join, this.params, this.timeout);\n    this.pushBuffer = [];\n    this.rejoinTimer = new Timer(function () {\n      return _this2.rejoinUntilConnected();\n    }, this.socket.reconnectAfterMs);\n    this.joinPush.receive(\"ok\", function () {\n      _this2.state = CHANNEL_STATES.joined;\n      _this2.rejoinTimer.reset();\n      _this2.pushBuffer.forEach(function (pushEvent) {\n        return pushEvent.send();\n      });\n      _this2.pushBuffer = [];\n    });\n    this.onClose(function () {\n      _this2.rejoinTimer.reset();\n      _this2.socket.log(\"channel\", \"close \" + _this2.topic + \" \" + _this2.joinRef());\n      _this2.state = CHANNEL_STATES.closed;\n      _this2.socket.remove(_this2);\n    });\n    this.onError(function (reason) {\n      if (_this2.isLeaving() || _this2.isClosed()) {\n        return;\n      }\n      _this2.socket.log(\"channel\", \"error \" + _this2.topic, reason);\n      _this2.state = CHANNEL_STATES.errored;\n      _this2.rejoinTimer.scheduleTimeout();\n    });\n    this.joinPush.receive(\"timeout\", function () {\n      if (!_this2.isJoining()) {\n        return;\n      }\n      _this2.socket.log(\"channel\", \"timeout \" + _this2.topic, _this2.joinPush.timeout);\n      _this2.state = CHANNEL_STATES.errored;\n      _this2.rejoinTimer.scheduleTimeout();\n    });\n    this.on(CHANNEL_EVENTS.reply, function (payload, ref) {\n      _this2.trigger(_this2.replyEventName(ref), payload);\n    });\n  }\n\n  _createClass(Channel, [{\n    key: \"rejoinUntilConnected\",\n    value: function rejoinUntilConnected() {\n      this.rejoinTimer.scheduleTimeout();\n      if (this.socket.isConnected()) {\n        this.rejoin();\n      }\n    }\n  }, {\n    key: \"join\",\n    value: function join() {\n      var timeout = arguments.length <= 0 || arguments[0] === undefined ? this.timeout : arguments[0];\n\n      if (this.joinedOnce) {\n        throw \"tried to join multiple times. 'join' can only be called a single time per channel instance\";\n      } else {\n        this.joinedOnce = true;\n        this.rejoin(timeout);\n        return this.joinPush;\n      }\n    }\n  }, {\n    key: \"onClose\",\n    value: function onClose(callback) {\n      this.on(CHANNEL_EVENTS.close, callback);\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(callback) {\n      this.on(CHANNEL_EVENTS.error, function (reason) {\n        return callback(reason);\n      });\n    }\n  }, {\n    key: \"on\",\n    value: function on(event, callback) {\n      this.bindings.push({ event: event, callback: callback });\n    }\n  }, {\n    key: \"off\",\n    value: function off(event) {\n      this.bindings = this.bindings.filter(function (bind) {\n        return bind.event !== event;\n      });\n    }\n  }, {\n    key: \"canPush\",\n    value: function canPush() {\n      return this.socket.isConnected() && this.isJoined();\n    }\n  }, {\n    key: \"push\",\n    value: function push(event, payload) {\n      var timeout = arguments.length <= 2 || arguments[2] === undefined ? this.timeout : arguments[2];\n\n      if (!this.joinedOnce) {\n        throw \"tried to push '\" + event + \"' to '\" + this.topic + \"' before joining. Use channel.join() before pushing events\";\n      }\n      var pushEvent = new Push(this, event, payload, timeout);\n      if (this.canPush()) {\n        pushEvent.send();\n      } else {\n        pushEvent.startTimeout();\n        this.pushBuffer.push(pushEvent);\n      }\n\n      return pushEvent;\n    }\n\n    // Leaves the channel\n    //\n    // Unsubscribes from server events, and\n    // instructs channel to terminate on server\n    //\n    // Triggers onClose() hooks\n    //\n    // To receive leave acknowledgements, use the a `receive`\n    // hook to bind to the server ack, ie:\n    //\n    //     channel.leave().receive(\"ok\", () => alert(\"left!\") )\n    //\n\n  }, {\n    key: \"leave\",\n    value: function leave() {\n      var _this3 = this;\n\n      var timeout = arguments.length <= 0 || arguments[0] === undefined ? this.timeout : arguments[0];\n\n      this.state = CHANNEL_STATES.leaving;\n      var onClose = function onClose() {\n        _this3.socket.log(\"channel\", \"leave \" + _this3.topic);\n        _this3.trigger(CHANNEL_EVENTS.close, \"leave\", _this3.joinRef());\n      };\n      var leavePush = new Push(this, CHANNEL_EVENTS.leave, {}, timeout);\n      leavePush.receive(\"ok\", function () {\n        return onClose();\n      }).receive(\"timeout\", function () {\n        return onClose();\n      });\n      leavePush.send();\n      if (!this.canPush()) {\n        leavePush.trigger(\"ok\", {});\n      }\n\n      return leavePush;\n    }\n\n    // Overridable message hook\n    //\n    // Receives all events for specialized message handling\n    // before dispatching to the channel callbacks.\n    //\n    // Must return the payload, modified or unmodified\n\n  }, {\n    key: \"onMessage\",\n    value: function onMessage(event, payload, ref) {\n      return payload;\n    }\n\n    // private\n\n  }, {\n    key: \"isMember\",\n    value: function isMember(topic) {\n      return this.topic === topic;\n    }\n  }, {\n    key: \"joinRef\",\n    value: function joinRef() {\n      return this.joinPush.ref;\n    }\n  }, {\n    key: \"sendJoin\",\n    value: function sendJoin(timeout) {\n      this.state = CHANNEL_STATES.joining;\n      this.joinPush.resend(timeout);\n    }\n  }, {\n    key: \"rejoin\",\n    value: function rejoin() {\n      var timeout = arguments.length <= 0 || arguments[0] === undefined ? this.timeout : arguments[0];\n      if (this.isLeaving()) {\n        return;\n      }\n      this.sendJoin(timeout);\n    }\n  }, {\n    key: \"trigger\",\n    value: function trigger(event, payload, ref) {\n      var close = CHANNEL_EVENTS.close;\n      var error = CHANNEL_EVENTS.error;\n      var leave = CHANNEL_EVENTS.leave;\n      var join = CHANNEL_EVENTS.join;\n\n      if (ref && [close, error, leave, join].indexOf(event) >= 0 && ref !== this.joinRef()) {\n        return;\n      }\n      var handledPayload = this.onMessage(event, payload, ref);\n      if (payload && !handledPayload) {\n        throw \"channel onMessage callbacks must return the payload, modified or unmodified\";\n      }\n\n      this.bindings.filter(function (bind) {\n        return bind.event === event;\n      }).map(function (bind) {\n        return bind.callback(handledPayload, ref);\n      });\n    }\n  }, {\n    key: \"replyEventName\",\n    value: function replyEventName(ref) {\n      return \"chan_reply_\" + ref;\n    }\n  }, {\n    key: \"isClosed\",\n    value: function isClosed() {\n      return this.state === CHANNEL_STATES.closed;\n    }\n  }, {\n    key: \"isErrored\",\n    value: function isErrored() {\n      return this.state === CHANNEL_STATES.errored;\n    }\n  }, {\n    key: \"isJoined\",\n    value: function isJoined() {\n      return this.state === CHANNEL_STATES.joined;\n    }\n  }, {\n    key: \"isJoining\",\n    value: function isJoining() {\n      return this.state === CHANNEL_STATES.joining;\n    }\n  }, {\n    key: \"isLeaving\",\n    value: function isLeaving() {\n      return this.state === CHANNEL_STATES.leaving;\n    }\n  }]);\n\n  return Channel;\n}();\n\nvar Socket = exports.Socket = function () {\n\n  // Initializes the Socket\n  //\n  // endPoint - The string WebSocket endpoint, ie, \"ws://example.com/ws\",\n  //                                               \"wss://example.com\"\n  //                                               \"/ws\" (inherited host & protocol)\n  // opts - Optional configuration\n  //   transport - The Websocket Transport, for example WebSocket or Phoenix.LongPoll.\n  //               Defaults to WebSocket with automatic LongPoll fallback.\n  //   timeout - The default timeout in milliseconds to trigger push timeouts.\n  //             Defaults `DEFAULT_TIMEOUT`\n  //   heartbeatIntervalMs - The millisec interval to send a heartbeat message\n  //   reconnectAfterMs - The optional function that returns the millsec\n  //                      reconnect interval. Defaults to stepped backoff of:\n  //\n  //     function(tries){\n  //       return [1000, 5000, 10000][tries - 1] || 10000\n  //     }\n  //\n  //   logger - The optional function for specialized logging, ie:\n  //     `logger: (kind, msg, data) => { console.log(`${kind}: ${msg}`, data) }\n  //\n  //   longpollerTimeout - The maximum timeout of a long poll AJAX request.\n  //                        Defaults to 20s (double the server long poll timer).\n  //\n  //   params - The optional params to pass when connecting\n  //\n  // For IE8 support use an ES5-shim (https://github.com/es-shims/es5-shim)\n  //\n\n  function Socket(endPoint) {\n    var _this4 = this;\n\n    var opts = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n    _classCallCheck(this, Socket);\n\n    this.stateChangeCallbacks = { open: [], close: [], error: [], message: [] };\n    this.channels = [];\n    this.sendBuffer = [];\n    this.ref = 0;\n    this.timeout = opts.timeout || DEFAULT_TIMEOUT;\n    this.transport = opts.transport || window.WebSocket || LongPoll;\n    this.heartbeatIntervalMs = opts.heartbeatIntervalMs || 30000;\n    this.reconnectAfterMs = opts.reconnectAfterMs || function (tries) {\n      return [1000, 2000, 5000, 10000][tries - 1] || 10000;\n    };\n    this.logger = opts.logger || function () {}; // noop\n    this.longpollerTimeout = opts.longpollerTimeout || 20000;\n    this.params = opts.params || {};\n    this.endPoint = endPoint + \"/\" + TRANSPORTS.websocket;\n    this.reconnectTimer = new Timer(function () {\n      _this4.disconnect(function () {\n        return _this4.connect();\n      });\n    }, this.reconnectAfterMs);\n  }\n\n  _createClass(Socket, [{\n    key: \"protocol\",\n    value: function protocol() {\n      return location.protocol.match(/^https/) ? \"wss\" : \"ws\";\n    }\n  }, {\n    key: \"endPointURL\",\n    value: function endPointURL() {\n      var uri = Ajax.appendParams(Ajax.appendParams(this.endPoint, this.params), { vsn: VSN });\n      if (uri.charAt(0) !== \"/\") {\n        return uri;\n      }\n      if (uri.charAt(1) === \"/\") {\n        return this.protocol() + \":\" + uri;\n      }\n\n      return this.protocol() + \"://\" + location.host + uri;\n    }\n  }, {\n    key: \"disconnect\",\n    value: function disconnect(callback, code, reason) {\n      if (this.conn) {\n        this.conn.onclose = function () {}; // noop\n        if (code) {\n          this.conn.close(code, reason || \"\");\n        } else {\n          this.conn.close();\n        }\n        this.conn = null;\n      }\n      callback && callback();\n    }\n\n    // params - The params to send when connecting, for example `{user_id: userToken}`\n\n  }, {\n    key: \"connect\",\n    value: function connect(params) {\n      var _this5 = this;\n\n      if (params) {\n        console && console.log(\"passing params to connect is deprecated. Instead pass :params to the Socket constructor\");\n        this.params = params;\n      }\n      if (this.conn) {\n        return;\n      }\n\n      this.conn = new this.transport(this.endPointURL());\n      this.conn.timeout = this.longpollerTimeout;\n      this.conn.onopen = function () {\n        return _this5.onConnOpen();\n      };\n      this.conn.onerror = function (error) {\n        return _this5.onConnError(error);\n      };\n      this.conn.onmessage = function (event) {\n        return _this5.onConnMessage(event);\n      };\n      this.conn.onclose = function (event) {\n        return _this5.onConnClose(event);\n      };\n    }\n\n    // Logs the message. Override `this.logger` for specialized logging. noops by default\n\n  }, {\n    key: \"log\",\n    value: function log(kind, msg, data) {\n      this.logger(kind, msg, data);\n    }\n\n    // Registers callbacks for connection state change events\n    //\n    // Examples\n    //\n    //    socket.onError(function(error){ alert(\"An error occurred\") })\n    //\n\n  }, {\n    key: \"onOpen\",\n    value: function onOpen(callback) {\n      this.stateChangeCallbacks.open.push(callback);\n    }\n  }, {\n    key: \"onClose\",\n    value: function onClose(callback) {\n      this.stateChangeCallbacks.close.push(callback);\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(callback) {\n      this.stateChangeCallbacks.error.push(callback);\n    }\n  }, {\n    key: \"onMessage\",\n    value: function onMessage(callback) {\n      this.stateChangeCallbacks.message.push(callback);\n    }\n  }, {\n    key: \"onConnOpen\",\n    value: function onConnOpen() {\n      var _this6 = this;\n\n      this.log(\"transport\", \"connected to \" + this.endPointURL(), this.transport.prototype);\n      this.flushSendBuffer();\n      this.reconnectTimer.reset();\n      if (!this.conn.skipHeartbeat) {\n        clearInterval(this.heartbeatTimer);\n        this.heartbeatTimer = setInterval(function () {\n          return _this6.sendHeartbeat();\n        }, this.heartbeatIntervalMs);\n      }\n      this.stateChangeCallbacks.open.forEach(function (callback) {\n        return callback();\n      });\n    }\n  }, {\n    key: \"onConnClose\",\n    value: function onConnClose(event) {\n      this.log(\"transport\", \"close\", event);\n      this.triggerChanError();\n      clearInterval(this.heartbeatTimer);\n      this.reconnectTimer.scheduleTimeout();\n      this.stateChangeCallbacks.close.forEach(function (callback) {\n        return callback(event);\n      });\n    }\n  }, {\n    key: \"onConnError\",\n    value: function onConnError(error) {\n      this.log(\"transport\", error);\n      this.triggerChanError();\n      this.stateChangeCallbacks.error.forEach(function (callback) {\n        return callback(error);\n      });\n    }\n  }, {\n    key: \"triggerChanError\",\n    value: function triggerChanError() {\n      this.channels.forEach(function (channel) {\n        return channel.trigger(CHANNEL_EVENTS.error);\n      });\n    }\n  }, {\n    key: \"connectionState\",\n    value: function connectionState() {\n      switch (this.conn && this.conn.readyState) {\n        case SOCKET_STATES.connecting:\n          return \"connecting\";\n        case SOCKET_STATES.open:\n          return \"open\";\n        case SOCKET_STATES.closing:\n          return \"closing\";\n        default:\n          return \"closed\";\n      }\n    }\n  }, {\n    key: \"isConnected\",\n    value: function isConnected() {\n      return this.connectionState() === \"open\";\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(channel) {\n      this.channels = this.channels.filter(function (c) {\n        return c.joinRef() !== channel.joinRef();\n      });\n    }\n  }, {\n    key: \"channel\",\n    value: function channel(topic) {\n      var chanParams = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n      var chan = new Channel(topic, chanParams, this);\n      this.channels.push(chan);\n      return chan;\n    }\n  }, {\n    key: \"push\",\n    value: function push(data) {\n      var _this7 = this;\n\n      var topic = data.topic;\n      var event = data.event;\n      var payload = data.payload;\n      var ref = data.ref;\n\n      var callback = function callback() {\n        return _this7.conn.send(JSON.stringify(data));\n      };\n      this.log(\"push\", topic + \" \" + event + \" (\" + ref + \")\", payload);\n      if (this.isConnected()) {\n        callback();\n      } else {\n        this.sendBuffer.push(callback);\n      }\n    }\n\n    // Return the next message ref, accounting for overflows\n\n  }, {\n    key: \"makeRef\",\n    value: function makeRef() {\n      var newRef = this.ref + 1;\n      if (newRef === this.ref) {\n        this.ref = 0;\n      } else {\n        this.ref = newRef;\n      }\n\n      return this.ref.toString();\n    }\n  }, {\n    key: \"sendHeartbeat\",\n    value: function sendHeartbeat() {\n      if (!this.isConnected()) {\n        return;\n      }\n      this.push({ topic: \"phoenix\", event: \"heartbeat\", payload: {}, ref: this.makeRef() });\n    }\n  }, {\n    key: \"flushSendBuffer\",\n    value: function flushSendBuffer() {\n      if (this.isConnected() && this.sendBuffer.length > 0) {\n        this.sendBuffer.forEach(function (callback) {\n          return callback();\n        });\n        this.sendBuffer = [];\n      }\n    }\n  }, {\n    key: \"onConnMessage\",\n    value: function onConnMessage(rawMessage) {\n      var msg = JSON.parse(rawMessage.data);\n      var topic = msg.topic;\n      var event = msg.event;\n      var payload = msg.payload;\n      var ref = msg.ref;\n\n      this.log(\"receive\", (payload.status || \"\") + \" \" + topic + \" \" + event + \" \" + (ref && \"(\" + ref + \")\" || \"\"), payload);\n      this.channels.filter(function (channel) {\n        return channel.isMember(topic);\n      }).forEach(function (channel) {\n        return channel.trigger(event, payload, ref);\n      });\n      this.stateChangeCallbacks.message.forEach(function (callback) {\n        return callback(msg);\n      });\n    }\n  }]);\n\n  return Socket;\n}();\n\nvar LongPoll = exports.LongPoll = function () {\n  function LongPoll(endPoint) {\n    _classCallCheck(this, LongPoll);\n\n    this.endPoint = null;\n    this.token = null;\n    this.skipHeartbeat = true;\n    this.onopen = function () {}; // noop\n    this.onerror = function () {}; // noop\n    this.onmessage = function () {}; // noop\n    this.onclose = function () {}; // noop\n    this.pollEndpoint = this.normalizeEndpoint(endPoint);\n    this.readyState = SOCKET_STATES.connecting;\n\n    this.poll();\n  }\n\n  _createClass(LongPoll, [{\n    key: \"normalizeEndpoint\",\n    value: function normalizeEndpoint(endPoint) {\n      return endPoint.replace(\"ws://\", \"http://\").replace(\"wss://\", \"https://\").replace(new RegExp(\"(.*)\\/\" + TRANSPORTS.websocket), \"$1/\" + TRANSPORTS.longpoll);\n    }\n  }, {\n    key: \"endpointURL\",\n    value: function endpointURL() {\n      return Ajax.appendParams(this.pollEndpoint, { token: this.token });\n    }\n  }, {\n    key: \"closeAndRetry\",\n    value: function closeAndRetry() {\n      this.close();\n      this.readyState = SOCKET_STATES.connecting;\n    }\n  }, {\n    key: \"ontimeout\",\n    value: function ontimeout() {\n      this.onerror(\"timeout\");\n      this.closeAndRetry();\n    }\n  }, {\n    key: \"poll\",\n    value: function poll() {\n      var _this8 = this;\n\n      if (!(this.readyState === SOCKET_STATES.open || this.readyState === SOCKET_STATES.connecting)) {\n        return;\n      }\n\n      Ajax.request(\"GET\", this.endpointURL(), \"application/json\", null, this.timeout, this.ontimeout.bind(this), function (resp) {\n        if (resp) {\n          var status = resp.status;\n          var token = resp.token;\n          var messages = resp.messages;\n\n          _this8.token = token;\n        } else {\n          var status = 0;\n        }\n\n        switch (status) {\n          case 200:\n            messages.forEach(function (msg) {\n              return _this8.onmessage({ data: JSON.stringify(msg) });\n            });\n            _this8.poll();\n            break;\n          case 204:\n            _this8.poll();\n            break;\n          case 410:\n            _this8.readyState = SOCKET_STATES.open;\n            _this8.onopen();\n            _this8.poll();\n            break;\n          case 0:\n          case 500:\n            _this8.onerror();\n            _this8.closeAndRetry();\n            break;\n          default:\n            throw \"unhandled poll status \" + status;\n        }\n      });\n    }\n  }, {\n    key: \"send\",\n    value: function send(body) {\n      var _this9 = this;\n\n      Ajax.request(\"POST\", this.endpointURL(), \"application/json\", body, this.timeout, this.onerror.bind(this, \"timeout\"), function (resp) {\n        if (!resp || resp.status !== 200) {\n          _this9.onerror(status);\n          _this9.closeAndRetry();\n        }\n      });\n    }\n  }, {\n    key: \"close\",\n    value: function close(code, reason) {\n      this.readyState = SOCKET_STATES.closed;\n      this.onclose();\n    }\n  }]);\n\n  return LongPoll;\n}();\n\nvar Ajax = exports.Ajax = function () {\n  function Ajax() {\n    _classCallCheck(this, Ajax);\n  }\n\n  _createClass(Ajax, null, [{\n    key: \"request\",\n    value: function request(method, endPoint, accept, body, timeout, ontimeout, callback) {\n      if (window.XDomainRequest) {\n        var req = new XDomainRequest(); // IE8, IE9\n        this.xdomainRequest(req, method, endPoint, body, timeout, ontimeout, callback);\n      } else {\n        var req = window.XMLHttpRequest ? new XMLHttpRequest() : // IE7+, Firefox, Chrome, Opera, Safari\n        new ActiveXObject(\"Microsoft.XMLHTTP\"); // IE6, IE5\n        this.xhrRequest(req, method, endPoint, accept, body, timeout, ontimeout, callback);\n      }\n    }\n  }, {\n    key: \"xdomainRequest\",\n    value: function xdomainRequest(req, method, endPoint, body, timeout, ontimeout, callback) {\n      var _this10 = this;\n\n      req.timeout = timeout;\n      req.open(method, endPoint);\n      req.onload = function () {\n        var response = _this10.parseJSON(req.responseText);\n        callback && callback(response);\n      };\n      if (ontimeout) {\n        req.ontimeout = ontimeout;\n      }\n\n      // Work around bug in IE9 that requires an attached onprogress handler\n      req.onprogress = function () {};\n\n      req.send(body);\n    }\n  }, {\n    key: \"xhrRequest\",\n    value: function xhrRequest(req, method, endPoint, accept, body, timeout, ontimeout, callback) {\n      var _this11 = this;\n\n      req.timeout = timeout;\n      req.open(method, endPoint, true);\n      req.setRequestHeader(\"Content-Type\", accept);\n      req.onerror = function () {\n        callback && callback(null);\n      };\n      req.onreadystatechange = function () {\n        if (req.readyState === _this11.states.complete && callback) {\n          var response = _this11.parseJSON(req.responseText);\n          callback(response);\n        }\n      };\n      if (ontimeout) {\n        req.ontimeout = ontimeout;\n      }\n\n      req.send(body);\n    }\n  }, {\n    key: \"parseJSON\",\n    value: function parseJSON(resp) {\n      return resp && resp !== \"\" ? JSON.parse(resp) : null;\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(obj, parentKey) {\n      var queryStr = [];\n      for (var key in obj) {\n        if (!obj.hasOwnProperty(key)) {\n          continue;\n        }\n        var paramKey = parentKey ? parentKey + \"[\" + key + \"]\" : key;\n        var paramVal = obj[key];\n        if ((typeof paramVal === \"undefined\" ? \"undefined\" : _typeof(paramVal)) === \"object\") {\n          queryStr.push(this.serialize(paramVal, paramKey));\n        } else {\n          queryStr.push(encodeURIComponent(paramKey) + \"=\" + encodeURIComponent(paramVal));\n        }\n      }\n      return queryStr.join(\"&\");\n    }\n  }, {\n    key: \"appendParams\",\n    value: function appendParams(url, params) {\n      if (Object.keys(params).length === 0) {\n        return url;\n      }\n\n      var prefix = url.match(/\\?/) ? \"&\" : \"?\";\n      return \"\" + url + prefix + this.serialize(params);\n    }\n  }]);\n\n  return Ajax;\n}();\n\nAjax.states = { complete: 4 };\n\nvar Presence = exports.Presence = {\n  syncState: function syncState(currentState, newState, onJoin, onLeave) {\n    var _this12 = this;\n\n    var state = this.clone(currentState);\n    var joins = {};\n    var leaves = {};\n\n    this.map(state, function (key, presence) {\n      if (!newState[key]) {\n        leaves[key] = presence;\n      }\n    });\n    this.map(newState, function (key, newPresence) {\n      var currentPresence = state[key];\n      if (currentPresence) {\n        (function () {\n          var newRefs = newPresence.metas.map(function (m) {\n            return m.phx_ref;\n          });\n          var curRefs = currentPresence.metas.map(function (m) {\n            return m.phx_ref;\n          });\n          var joinedMetas = newPresence.metas.filter(function (m) {\n            return curRefs.indexOf(m.phx_ref) < 0;\n          });\n          var leftMetas = currentPresence.metas.filter(function (m) {\n            return newRefs.indexOf(m.phx_ref) < 0;\n          });\n          if (joinedMetas.length > 0) {\n            joins[key] = newPresence;\n            joins[key].metas = joinedMetas;\n          }\n          if (leftMetas.length > 0) {\n            leaves[key] = _this12.clone(currentPresence);\n            leaves[key].metas = leftMetas;\n          }\n        })();\n      } else {\n        joins[key] = newPresence;\n      }\n    });\n    return this.syncDiff(state, { joins: joins, leaves: leaves }, onJoin, onLeave);\n  },\n  syncDiff: function syncDiff(currentState, _ref2, onJoin, onLeave) {\n    var joins = _ref2.joins;\n    var leaves = _ref2.leaves;\n\n    var state = this.clone(currentState);\n    if (!onJoin) {\n      onJoin = function onJoin() {};\n    }\n    if (!onLeave) {\n      onLeave = function onLeave() {};\n    }\n\n    this.map(joins, function (key, newPresence) {\n      var currentPresence = state[key];\n      state[key] = newPresence;\n      if (currentPresence) {\n        var _state$key$metas;\n\n        (_state$key$metas = state[key].metas).unshift.apply(_state$key$metas, _toConsumableArray(currentPresence.metas));\n      }\n      onJoin(key, currentPresence, newPresence);\n    });\n    this.map(leaves, function (key, leftPresence) {\n      var currentPresence = state[key];\n      if (!currentPresence) {\n        return;\n      }\n      var refsToRemove = leftPresence.metas.map(function (m) {\n        return m.phx_ref;\n      });\n      currentPresence.metas = currentPresence.metas.filter(function (p) {\n        return refsToRemove.indexOf(p.phx_ref) < 0;\n      });\n      onLeave(key, currentPresence, leftPresence);\n      if (currentPresence.metas.length === 0) {\n        delete state[key];\n      }\n    });\n    return state;\n  },\n  list: function list(presences, chooser) {\n    if (!chooser) {\n      chooser = function chooser(key, pres) {\n        return pres;\n      };\n    }\n\n    return this.map(presences, function (key, presence) {\n      return chooser(key, presence);\n    });\n  },\n\n  // private\n\n  map: function map(obj, func) {\n    return Object.getOwnPropertyNames(obj).map(function (key) {\n      return func(key, obj[key]);\n    });\n  },\n  clone: function clone(obj) {\n    return JSON.parse(JSON.stringify(obj));\n  }\n};\n\n// Creates a timer that accepts a `timerCalc` function to perform\n// calculated timeout retries, such as exponential backoff.\n//\n// ## Examples\n//\n//    let reconnectTimer = new Timer(() => this.connect(), function(tries){\n//      return [1000, 5000, 10000][tries - 1] || 10000\n//    })\n//    reconnectTimer.scheduleTimeout() // fires after 1000\n//    reconnectTimer.scheduleTimeout() // fires after 5000\n//    reconnectTimer.reset()\n//    reconnectTimer.scheduleTimeout() // fires after 1000\n//\n\nvar Timer = function () {\n  function Timer(callback, timerCalc) {\n    _classCallCheck(this, Timer);\n\n    this.callback = callback;\n    this.timerCalc = timerCalc;\n    this.timer = null;\n    this.tries = 0;\n  }\n\n  _createClass(Timer, [{\n    key: \"reset\",\n    value: function reset() {\n      this.tries = 0;\n      clearTimeout(this.timer);\n    }\n\n    // Cancels any previous scheduleTimeout and schedules callback\n\n  }, {\n    key: \"scheduleTimeout\",\n    value: function scheduleTimeout() {\n      var _this13 = this;\n\n      clearTimeout(this.timer);\n\n      this.timer = setTimeout(function () {\n        _this13.tries = _this13.tries + 1;\n        _this13.callback();\n      }, this.timerCalc(this.tries + 1));\n    }\n  }]);\n\n  return Timer;\n}();\n\n})(typeof(exports) === \"undefined\" ? window.Phoenix = window.Phoenix || {} : exports);\n  })();\n});","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst phoenix_1 = require(\"phoenix\");\nconst constants_1 = require(\"./constants\");\nconst state_1 = require(\"./state\");\nconst entities_1 = require(\"./entities\");\nconst game_1 = require(\"./game\");\nclass App {\n    static start() {\n        this.socket = new phoenix_1.Socket(\"/socket\", {});\n        this.socket.connect();\n        this.roomChan = this.socket.channel(\"rooms:lobby\", {});\n        this.roomChan.join().receive(\"ignore\", () => console.log(\"auth error\"))\n            .receive(\"ok\", () => { console.log(\"join ok\"); });\n        this.roomChan.onError(e => console.log(\"something went wrong\", e));\n        this.roomChan.on(\"init_data\", (data) => {\n            this.run(data.id, data.team);\n            for (const block of data.blocks) {\n                this.game.state.level.collidables.push(new entities_1.PlayerBlock(block.x, block.y, block.id, block.team));\n            }\n        });\n    }\n    static run(id, team) {\n        // chan.onClose(e => console.log(\"channel closed\", e))\n        this.game = new game_1.Game(id, team);\n        this.game.state.roomChan = this.roomChan;\n        const game = this.game;\n        const c = game.canvas;\n        const sheet = game_1.Game.spriteSheet;\n        const gs = game.state;\n        // Start the game loop\n        game.run();\n        this.roomChan.on(\"update_player\", (msg) => {\n            if (msg.id === this.game.state.user_id) {\n                return;\n            }\n            const changedPlayer = this.game.state.playerStates.filter(x => x.id === msg.id);\n            if (changedPlayer.length === 1) {\n                changedPlayer[0].x = msg.x;\n                changedPlayer[0].y = msg.y;\n            }\n            else if (changedPlayer.length === 0) {\n                this.game.state.playerStates.push(new state_1.PlayerState(msg.x, msg.y, msg.id, msg.team));\n            }\n        });\n        this.roomChan.on(\"remove_player\", (res) => {\n            const data = res.data;\n            const new_id = res.new_id;\n            const player_idx = this.game.state.playerStates.findIndex((x) => x.id === data.id);\n            console.log(data.id, this.game.state.user_id);\n            if (data.id !== this.game.state.user_id) {\n                this.game.state.playerStates.splice(player_idx, 1);\n            }\n            else {\n                const new_id = Math.floor(Math.random() * 10000);\n                this.game.state.userState.id = new_id;\n                this.game.state.user_id = new_id;\n            }\n        });\n        this.roomChan.on(\"add_block\", (data) => {\n            this.game.state.level.collidables.push(new entities_1.PlayerBlock(data.x, data.y, data.id, data.team));\n        });\n        this.roomChan.on(\"remove_blocks\", (data) => {\n            for (let block of this.game.state.level.collidables) {\n                if (block instanceof entities_1.PlayerBlock && data.block_ids.indexOf(block.id) !== -1) {\n                    block.team = (block.team === 1) ? 0 : 1;\n                }\n            }\n        });\n        this.roomChan.on(\"overview_data\", (data) => {\n            for (let i = 0; i < constants_1.Constants.TEAMS; i++) {\n                this.game.state.flags[i].holding_id = data.flag_holder[i];\n            }\n            this.game.state.scores = data.score;\n        });\n    }\n}\nApp.start();\nexports.default = App;\n//# sourceMappingURL=app.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst constants_1 = require(\"./constants\");\nclass Camera {\n    static updateTarget(user) {\n        this.targetX = user.x + constants_1.Constants.PLAYER_W / 2 - constants_1.Constants.W / 2;\n        this.targetY = user.y + constants_1.Constants.PLAYER_H / 2 - constants_1.Constants.H / 2;\n    }\n    static update() {\n        this.cx += (this.targetX - this.cx) * 0.1;\n        this.cy += (this.targetY - this.cy) * 0.1;\n        if (this.cx > constants_1.Constants.LEVEL_W - constants_1.Constants.W)\n            this.cx = constants_1.Constants.LEVEL_W - constants_1.Constants.W;\n        if (this.cx < 0)\n            this.cx = 0;\n        if (this.cy > constants_1.Constants.LEVEL_H - constants_1.Constants.H)\n            this.cy = constants_1.Constants.LEVEL_H - constants_1.Constants.H;\n        if (this.cy < 0)\n            this.cy = 0;\n    }\n    static get x() {\n        return Math.floor(this.cx);\n    }\n    static get y() {\n        return Math.floor(this.cy);\n    }\n}\nCamera.cx = 0;\nCamera.cy = 0;\nCamera.targetX = 0;\nCamera.targetY = 0;\nexports.Camera = Camera;\n//# sourceMappingURL=camera.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass Constants {\n}\nConstants.TEAMS = 2;\nConstants.TEAM_NAMES = [\"Blue\", \"Red\"];\nConstants.DESTROY_RADIUS = 64;\nConstants.PLAYER_W = 32;\nConstants.PLAYER_H = 32;\nConstants.W = 640;\nConstants.H = 640;\nConstants.LEVEL_W = 0;\nConstants.LEVEL_H = 0;\nexports.Constants = Constants;\n//# sourceMappingURL=constants.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst constants_1 = require(\"./constants\");\nconst camera_1 = require(\"./camera\");\nconst game_1 = require(\"./game\");\nclass Block {\n    constructor(x, y) {\n        this.x = 0;\n        this.y = 0;\n        this.w = constants_1.Constants.PLAYER_W;\n        this.h = constants_1.Constants.PLAYER_H;\n        this.left = 0;\n        this.right = 0;\n        this.top = 0;\n        this.bottom = 0;\n        this.x = x;\n        this.y = y;\n    }\n    draw(ctx) {\n        ctx.fillRect(this.x - camera_1.Camera.x, this.y - camera_1.Camera.y, this.w, this.h);\n    }\n}\nexports.Block = Block;\nclass PlayerBlock {\n    constructor(x, y, id, team) {\n        this.x = 0;\n        this.y = 0;\n        this.w = constants_1.Constants.PLAYER_W;\n        this.h = constants_1.Constants.PLAYER_H;\n        this.left = 0;\n        this.right = 0;\n        this.top = 0;\n        this.bottom = 0;\n        this.id = 0;\n        this.team = 0;\n        this.x = x;\n        this.y = y;\n        this.id = id;\n        this.team = team;\n    }\n    draw(ctx) {\n        ctx.drawImage(game_1.Game.spriteSheet, constants_1.Constants.PLAYER_W * (5 + this.team), 0, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H, this.x - camera_1.Camera.x, this.y - camera_1.Camera.y, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n    }\n}\nexports.PlayerBlock = PlayerBlock;\nclass Flag {\n    constructor(x, y, team) {\n        this.x = 0;\n        this.y = 0;\n        this.w = constants_1.Constants.PLAYER_W;\n        this.h = constants_1.Constants.PLAYER_H;\n        this.left = 6;\n        this.right = 6;\n        this.top = 13;\n        this.bottom = 0;\n        this.team = 0;\n        this.holding_id = null; // if it's null, nobody has it\n        this.x = x;\n        this.y = y;\n        this.team = team;\n    }\n    draw(ctx) {\n        if (this.holding_id === null) {\n            ctx.drawImage(game_1.Game.spriteSheet, constants_1.Constants.PLAYER_W * (2 + this.team), 0, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H, this.x - camera_1.Camera.x, this.y - camera_1.Camera.y, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n        }\n    }\n}\nexports.Flag = Flag;\nclass ScoringArea {\n    constructor(x, y, team) {\n        this.x = 0;\n        this.y = 0;\n        this.w = constants_1.Constants.PLAYER_W;\n        this.h = constants_1.Constants.PLAYER_H;\n        this.left = 0;\n        this.right = 0;\n        this.top = 0;\n        this.bottom = 0;\n        this.team = 0;\n        this.x = x;\n        this.y = y;\n        this.team = team;\n    }\n    draw(ctx) {\n        ctx.drawImage(game_1.Game.spriteSheet, constants_1.Constants.PLAYER_W * (5 + this.team), constants_1.Constants.PLAYER_H, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H, this.x - camera_1.Camera.x, this.y - camera_1.Camera.y, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n    }\n}\nexports.ScoringArea = ScoringArea;\nclass Spike {\n    constructor(x, y) {\n        this.x = 0;\n        this.y = 0;\n        this.w = constants_1.Constants.PLAYER_W;\n        this.h = constants_1.Constants.PLAYER_H;\n        this.left = 0;\n        this.right = 0;\n        this.top = constants_1.Constants.PLAYER_H / 2;\n        this.bottom = 0;\n        this.x = x;\n        this.y = y;\n    }\n    draw(ctx) {\n        ctx.drawImage(game_1.Game.spriteSheet, constants_1.Constants.PLAYER_W * 4, 0, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H, this.x - camera_1.Camera.x, this.y - camera_1.Camera.y, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n    }\n}\nexports.Spike = Spike;\nclass Explosion {\n    constructor(x, y) {\n        this.x = 0;\n        this.y = 0;\n        this.w = constants_1.Constants.PLAYER_W * 2;\n        this.h = constants_1.Constants.PLAYER_W * 2;\n        this.startTick = -1;\n        this.dead = false;\n        this.x = x;\n        this.y = y;\n    }\n    draw(tick, ctx) {\n        if (this.startTick === -1) {\n            this.startTick = tick;\n        }\n        let frame = Math.floor((tick - this.startTick) / 2);\n        if (frame > 9) {\n            this.dead = true;\n        }\n        if (!this.dead) {\n            ctx.drawImage(game_1.Game.spriteSheet, this.w * frame, constants_1.Constants.PLAYER_H * 4, this.w, this.h, this.x - camera_1.Camera.x - this.w / 2, this.y - camera_1.Camera.y - this.h / 2, this.w, this.h);\n        }\n    }\n}\nexports.Explosion = Explosion;\nclass Level {\n    addBlock(x, y) {\n        this.collidables.push(new Block(x, y));\n    }\n    addSpike(x, y) {\n        this.collidables.push(new Spike(x, y));\n    }\n    addFlag(x, y, team) {\n        let flag = new Flag(x, y, team);\n        this.collidables.push(flag);\n        return flag;\n    }\n    addScoringArea(x, y, team) {\n        this.collidables.push(new ScoringArea(x, y, team));\n    }\n    create(gs) {\n        this.collidables = new Array();\n        this.explosions = new Array();\n        let levelImage = new Image();\n        levelImage.src = \"images/level.png\";\n        levelImage.onload = () => {\n            let canvas = document.createElement(\"canvas\");\n            canvas.width = levelImage.width;\n            canvas.height = levelImage.height;\n            let ctx = canvas.getContext(\"2d\");\n            ctx.drawImage(levelImage, 0, 0, levelImage.width, levelImage.height);\n            let data = ctx.getImageData(0, 0, levelImage.width, levelImage.height).data;\n            constants_1.Constants.LEVEL_W = levelImage.width * 32;\n            constants_1.Constants.LEVEL_H = levelImage.height * 32;\n            for (let y = 0; y < levelImage.height; y++) {\n                for (let x = 0; x < levelImage.width; x++) {\n                    let r = data[(x + y * levelImage.width) * 4];\n                    let g = data[(x + y * levelImage.width) * 4 + 1];\n                    let b = data[(x + y * levelImage.width) * 4 + 2];\n                    if (r === 0 && g === 0 && b === 0) {\n                        this.addBlock(x * 32, y * 32);\n                    }\n                    if (r === 0 && g === 255 && b === 0 && gs.user_team === 0) {\n                        this.spawnX = x * 32;\n                        this.spawnY = y * 32;\n                        gs.userState.x = x * 32;\n                        gs.userState.y = y * 32;\n                    }\n                    if (r === 0 && g === 128 && b === 128 && gs.user_team === 1) {\n                        this.spawnX = x * 32;\n                        this.spawnY = y * 32;\n                        gs.userState.x = x * 32;\n                        gs.userState.y = y * 32;\n                    }\n                    if (r === 255 && g === 0 && b === 0) {\n                        this.addSpike(x * 32, y * 32);\n                    }\n                    if (r === 255 && g === 0 && b === 255) {\n                        this.addScoringArea(x * 32, y * 32, 0);\n                        gs.flags[0] = this.addFlag(x * 32, y * 32, 0);\n                    }\n                    if (r === 0 && g === 0 && b === 255) {\n                        this.addScoringArea(x * 32, y * 32, 1);\n                        gs.flags[1] = this.addFlag(x * 32, y * 32, 1);\n                    }\n                    if (r === 0 && g === 0 && b === 128) {\n                        this.addScoringArea(x * 32, y * 32, 1);\n                    }\n                    if (r === 128 && g === 0 && b === 128) {\n                        this.addScoringArea(x * 32, y * 32, 0);\n                    }\n                }\n            }\n        };\n    }\n}\nexports.Level = Level;\n//# sourceMappingURL=entities.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst entities_1 = require(\"./entities\");\nconst state_1 = require(\"./state\");\nconst constants_1 = require(\"./constants\");\nconst camera_1 = require(\"./camera\");\nclass PlayerData {\n    constructor(x, y, id, team, nickname) {\n        this.x = 0;\n        this.y = 0;\n        this.id = 0;\n        this.team = 0;\n        this.nickname = \"\";\n        this.x = x;\n        this.y = y;\n        this.id = id;\n        this.team = team;\n        this.nickname = nickname;\n    }\n}\nexports.PlayerData = PlayerData;\nclass Game {\n    constructor(id, team) {\n        this.canvas = document.getElementById(\"gameCanvas\");\n        Game.spriteSheet = new Image();\n        Game.spriteSheet.src = \"images/sheet.png\";\n        this.state = new state_1.GameState(id, team);\n    }\n    checkCollision(a, b) {\n        if (a.x >= b.x + b.w - a.left - b.right || a.x + constants_1.Constants.PLAYER_W - a.right - b.left <= b.x)\n            return false;\n        if (a.y >= b.y + b.h - a.top - b.bottom || a.y + constants_1.Constants.PLAYER_H - b.top <= b.y)\n            return false;\n        return true;\n    }\n    takeFlag(flag) {\n        this.state.roomChan.push(\"take_flag\", {\n            id: this.state.user_id,\n            team: flag.team\n        }).receive(\"fail\", () => {\n            flag.holding_id = null;\n        });\n        flag.holding_id = this.state.user_id;\n    }\n    scoreFlag(flag) {\n        this.state.roomChan.push(\"score_flag\", {\n            id: this.state.user_id,\n            user_team: this.state.user_team,\n            flag_team: flag.team\n        });\n        flag.holding_id = null;\n    }\n    blockInRange(block) {\n        let blockX = block.x + block.w / 2;\n        let blockY = block.y + block.h / 2;\n        let pX = this.state.userState.x + constants_1.Constants.PLAYER_W / 2;\n        let pY = this.state.userState.y + constants_1.Constants.PLAYER_H / 2;\n        return (Math.hypot(blockX - pX, blockY - pY) < constants_1.Constants.DESTROY_RADIUS);\n    }\n    sudoku() {\n        this.state.level.explosions.push(new entities_1.Explosion(this.state.userState.x + constants_1.Constants.PLAYER_W / 2, this.state.userState.y + constants_1.Constants.PLAYER_H / 2));\n        let ids = new Array();\n        for (const obj of this.state.level.collidables) {\n            if (obj instanceof entities_1.PlayerBlock && obj.team !== this.state.user_team) {\n                console.log(\"Potential block: \", obj.team, this.blockInRange(obj));\n            }\n            if (obj instanceof entities_1.PlayerBlock && obj.team !== this.state.user_team && this.blockInRange(obj)) {\n                ids.push(obj.id);\n            }\n        }\n        this.state.roomChan.push(\"sudoku\", new PlayerData(Math.floor(this.state.userState.x), Math.floor(this.state.userState.y), this.state.user_id, this.state.user_team, this.state.user_nickname));\n        console.log(\"destroy_block_ids/push\", ids);\n        this.state.roomChan.push(\"remove_blocks\", { block_ids: ids });\n        this.teleportPlayer();\n    }\n    killPlayer() {\n        this.state.roomChan.push(\"death\", new PlayerData(Math.floor(this.state.userState.x), Math.floor(this.state.userState.y), this.state.user_id, this.state.user_team, this.state.user_nickname));\n        this.teleportPlayer();\n    }\n    teleportPlayer() {\n        this.state.deathAnimFrame = 30;\n        this.state.userState.x = this.state.level.spawnX;\n        this.state.userState.y = this.state.level.spawnY;\n        this.state.userState.dx = 0;\n        this.state.userState.dy = 0;\n    }\n    run() {\n        const collisions = () => {\n            const gs = this.state;\n            let players = gs.playerStates;\n            let user = gs.userState;\n            user.can_jump = false;\n            user.y += user.dy;\n            for (const obj of this.state.level.collidables) {\n                if (this.checkCollision(user, obj)) {\n                    if (obj instanceof entities_1.ScoringArea) {\n                        if (obj.team === this.state.user_team) {\n                            for (const flag of this.state.flags) {\n                                if (flag.holding_id === this.state.user_id) {\n                                    this.scoreFlag(flag);\n                                }\n                            }\n                        }\n                    }\n                    else if (obj instanceof entities_1.PlayerBlock && obj.team === user.team) {\n                        user.y -= user.dy;\n                        if (!this.checkCollision(user, obj)) {\n                            user.y += user.dy;\n                            if (user.dy > 0) {\n                                user.dy = 0;\n                                user.can_jump = !Key.isDown(Key.UP);\n                                user.y = obj.y - constants_1.Constants.PLAYER_H + obj.top;\n                            }\n                        }\n                        else {\n                            user.y += user.dy;\n                        }\n                    }\n                    else if (obj instanceof entities_1.Flag) {\n                        if (obj.holding_id === null && obj.team !== this.state.user_team) {\n                            obj.holding_id = this.state.user_id;\n                            this.takeFlag(obj);\n                        }\n                    }\n                    else {\n                        user.y -= user.dy;\n                        if (!this.checkCollision(user, obj)) {\n                            user.y += user.dy;\n                            if (user.dy > 0) {\n                                user.dy = 0;\n                                user.can_jump = !Key.isDown(Key.UP);\n                                user.y = obj.y - constants_1.Constants.PLAYER_H + obj.top;\n                            }\n                            else {\n                                user.dy = 0;\n                                user.y = obj.y + obj.h - user.top - obj.bottom;\n                            }\n                            if (obj instanceof entities_1.Spike) {\n                                this.killPlayer();\n                            }\n                        }\n                        else {\n                            user.dy += user.dy;\n                        }\n                    }\n                }\n            }\n            user.x += user.dx;\n            for (const obj of this.state.level.collidables) {\n                if (this.checkCollision(user, obj) && !(obj instanceof entities_1.PlayerBlock && obj.team === user.team)) {\n                    if (obj instanceof entities_1.ScoringArea) {\n                        if (obj.team === this.state.user_team) {\n                            for (const flag of this.state.flags) {\n                                if (flag.holding_id === this.state.user_id) {\n                                    this.scoreFlag(flag);\n                                }\n                            }\n                        }\n                    }\n                    else if (obj instanceof entities_1.Flag) {\n                        if (obj.holding_id === null && obj.team !== this.state.user_team) {\n                            obj.holding_id = this.state.user_id;\n                            this.takeFlag(obj);\n                        }\n                    }\n                    else {\n                        user.x -= user.dx;\n                        if (!this.checkCollision(user, obj)) {\n                            user.x += user.dx;\n                            if (user.dx > 0) {\n                                user.x = obj.x - constants_1.Constants.PLAYER_W + user.right + obj.left;\n                            }\n                            else {\n                                user.x = obj.x + obj.w - user.left - obj.right;\n                            }\n                        }\n                        else {\n                            user.x += user.dx;\n                        }\n                    }\n                }\n            }\n        };\n        const draw = () => {\n            const ctx = this.canvas.getContext(\"2d\");\n            const gs = this.state;\n            ctx.fillStyle = 'rgb(139, 206, 210)';\n            ctx.fillRect(0, 0, constants_1.Constants.W, constants_1.Constants.H);\n            ctx.fillStyle = 'rgb(0, 0, 0)';\n            const user = this.state.userState;\n            for (const obj of this.state.level.collidables) {\n                obj.draw(ctx);\n            }\n            if (user.x_dir === -1) {\n                ctx.translate(Math.floor(user.x) + constants_1.Constants.PLAYER_W - camera_1.Camera.x, Math.floor(user.y) - camera_1.Camera.y);\n                ctx.scale(-1, 1);\n                if (user.dx != 0) {\n                    user.frame = Math.floor(this.state.tick / 5) % 4;\n                    ctx.drawImage(Game.spriteSheet, user.frame * constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H * (2 + user.team), constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H, 0, 0, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n                }\n                else {\n                    ctx.drawImage(Game.spriteSheet, 0, constants_1.Constants.PLAYER_H * user.team, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H, 0, 0, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n                }\n                ctx.setTransform(1, 0, 0, 1, 0, 0);\n            }\n            else {\n                if (user.dx != 0) {\n                    user.frame = Math.floor(this.state.tick / 5) % 4;\n                    ctx.drawImage(Game.spriteSheet, user.frame * constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H * (2 + user.team), constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H, Math.floor(user.x) - camera_1.Camera.x, Math.floor(user.y) - camera_1.Camera.y, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n                }\n                else {\n                    ctx.drawImage(Game.spriteSheet, 0, constants_1.Constants.PLAYER_H * user.team, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H, Math.floor(user.x) - camera_1.Camera.x, Math.floor(user.y) - camera_1.Camera.y, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n                }\n            }\n            for (const flag of this.state.flags) {\n                if (flag.holding_id === this.state.user_id) {\n                    ctx.drawImage(Game.spriteSheet, constants_1.Constants.PLAYER_W * (2 + flag.team), 0, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H, Math.floor(user.x) - camera_1.Camera.x, Math.floor(user.y) - camera_1.Camera.y - constants_1.Constants.PLAYER_H, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n                }\n            }\n            for (const player of this.state.nonUserStates) {\n                for (const flag of this.state.flags) {\n                    if (flag.holding_id === player.id) {\n                        ctx.drawImage(Game.spriteSheet, constants_1.Constants.PLAYER_W * (2 + flag.team), 0, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H, Math.floor(player.x) - camera_1.Camera.x, Math.floor(player.y) - camera_1.Camera.y - constants_1.Constants.PLAYER_H, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n                    }\n                }\n                ctx.fillRect(Math.floor(player.x) - camera_1.Camera.x, Math.floor(player.y) - camera_1.Camera.y, constants_1.Constants.PLAYER_W, constants_1.Constants.PLAYER_H);\n            }\n            for (const exp of this.state.level.explosions) {\n                exp.draw(this.state.tick, ctx);\n            }\n            let scoreText = \"\";\n            for (let i = 0; i < constants_1.Constants.TEAMS; i++) {\n                scoreText += `Team ${constants_1.Constants.TEAM_NAMES[i]} score: ${this.state.scores[i]}\\n`;\n            }\n            ctx.font = '64px PixelFont';\n            ctx.textBaseline = 'top';\n            let textPadding = {\n                x: 10,\n                y: 0\n            };\n            let team0Score = `${this.state.scores[0]}`;\n            ctx.fillStyle = 'rgb(255, 255, 255)';\n            ctx.fillText(team0Score, textPadding.x, textPadding.y);\n            let team1Score = `${this.state.scores[1]}`;\n            ctx.fillStyle = 'rgb(172, 35, 48)';\n            ctx.fillText(team1Score, constants_1.Constants.W - ctx.measureText(team1Score).width - textPadding.x, textPadding.y);\n        };\n        const Key = {\n            _pressed: {},\n            SPACE: 32,\n            LEFT: 37,\n            UP: 38,\n            RIGHT: 39,\n            DOWN: 40,\n            isDown: function (keyCode) {\n                return this._pressed[keyCode];\n            },\n            onKeydown: (event) => {\n                if (event.keyCode == Key.SPACE) {\n                    this.sudoku();\n                }\n                Key._pressed[event.keyCode] = true;\n            },\n            onKeyup: function (event) {\n                delete this._pressed[event.keyCode];\n            }\n        };\n        window.addEventListener('keyup', function (event) {\n            Key.onKeyup(event);\n        }, false);\n        window.addEventListener('keydown', function (event) {\n            Key.onKeydown(event);\n        }, false);\n        const check_bounds = (user) => {\n            if (user.x < 0)\n                user.x = 0;\n            if (user.x > constants_1.Constants.LEVEL_W - constants_1.Constants.PLAYER_W)\n                user.x = constants_1.Constants.LEVEL_W - constants_1.Constants.PLAYER_W;\n            if (user.y < 0) {\n                user.dy = 0;\n                user.y = 0;\n            }\n            if (user.y >= constants_1.Constants.LEVEL_H - constants_1.Constants.PLAYER_H) {\n                user.dy = 0;\n                user.y = constants_1.Constants.LEVEL_H - constants_1.Constants.PLAYER_H;\n                user.can_jump = !Key.isDown(Key.UP);\n            }\n        };\n        const update = () => {\n            const jump_v = 12;\n            const v = 4;\n            const gs = this.state;\n            const user = gs.userState;\n            this.state.tick++;\n            if (Key.isDown(Key.UP) && user.can_jump) {\n                user.dy = -jump_v;\n                user.can_jump = false;\n            }\n            if (Key.isDown(Key.LEFT)) {\n                user.dx += (-v - user.dx) * 0.2;\n                user.x_dir = -1;\n            }\n            else if (Key.isDown(Key.RIGHT)) {\n                user.dx += (v - user.dx) * 0.2;\n                user.x_dir = 1;\n            }\n            else {\n                user.dx *= 0.9;\n                if (Math.abs(user.dx) < 1) {\n                    user.dx = 0;\n                }\n            }\n            collisions();\n            check_bounds(user);\n            user.dy += 0.7;\n            this.state.level.explosions = this.state.level.explosions.filter(x => !x.dead);\n            if (this.state.deathAnimFrame === 0) {\n                camera_1.Camera.updateTarget(user);\n            }\n            else {\n                this.state.deathAnimFrame--;\n            }\n            camera_1.Camera.update();\n        };\n        const push = () => {\n            this.state.roomChan.push(\"update_player\", new PlayerData(this.state.userState.x, this.state.userState.y, this.state.user_id, this.state.user_team, this.state.user_nickname));\n        };\n        setInterval(() => {\n            update();\n            draw();\n            push();\n        }, 1000 / this.state.fps);\n    }\n}\nexports.Game = Game;\n//# sourceMappingURL=game.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst entities_1 = require(\"./entities\");\nconst constants_1 = require(\"./constants\");\nclass PlayerState {\n    constructor(x, y, id, team) {\n        this.x = 0;\n        this.y = 0;\n        this.left = 3;\n        this.right = 3;\n        this.top = 6;\n        this.x_dir = 1;\n        this.dx = 0;\n        this.dy = 0;\n        this.can_jump = false;\n        this.frame = 0;\n        this.id = 0;\n        this.team = 0;\n        this.x = x;\n        this.y = y;\n        this.id = id;\n        this.team = team;\n    }\n}\nexports.PlayerState = PlayerState;\nclass GameState {\n    constructor(id, team) {\n        this.user_id = 0;\n        this.scores = [];\n        this.flags = [];\n        this.deathAnimFrame = 0;\n        this.user_team = 0;\n        this.user_nickname = \"horsey\";\n        this.fps = 60;\n        this.tick = 0;\n        this.playerStates = new Array(new PlayerState(0, 0, id, team));\n        this.user_id = id;\n        this.user_team = team;\n        this.scores = new Array(constants_1.Constants.TEAMS);\n        this.scores.fill(0);\n        this.flags = new Array(constants_1.Constants.TEAMS);\n        this.level = new entities_1.Level();\n        this.level.create(this);\n    }\n    get userState() {\n        return this.playerStates.filter(x => x.id === this.user_id)[0];\n    }\n    get nonUserStates() {\n        return this.playerStates.filter(x => x.id !== this.user_id);\n    }\n}\nexports.GameState = GameState;\n//# sourceMappingURL=state.js.map"]}